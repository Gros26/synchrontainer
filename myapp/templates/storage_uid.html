<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archivos privados de {{ nombre }}</title>
    <!-- Enlace al CSS global -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <nav>
        <a href="{{ url_for('index') }}">Inicio</a> |
        <a href="{{ url_for('listar_archivos_publicos') }}">Archivos públicos</a>
    </nav>
    <h1>Archivos privados de {{ nombre }}</h1>
    {% if error %}
        <p style="color:red;">{{ error }}</p>
    {% else %}
        <!-- En lugar de url_for sólo, construimos la URL completa al contenedor destino -->
        <form id="uploadForm" action="#" method="post" enctype="multipart/form-data">
            <label style="width:100%;text-align:center;">Subir archivo privado</label>
            <input type="file" name="file" required>
            <input type="text" name="nombre" placeholder="Nombre para guardar (ej: archivo.txt)" required>
            <button type="submit" class="btn">Subir</button>
        </form>
        <ul>
            {% for archivo in archivos %}
                <li>{{ archivo }}
                    <a class="btn" href="{{ url_for('descargar_archivo_privado', uid=request.view_args['uid'], filename=archivo) }}">Descargar</a>
                </li>
            {% else %}
                <li style="text-align:center;width:100%;">No hay archivos privados para este contenedor.</li>
            {% endfor %}
        </ul>
        <script>
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            var nombreArchivo = document.querySelector('input[name="nombre"]').value;
            var uid = '{{ request.view_args["uid"] }}';
            var container = '{{ nombre }}';
            // Mapeo de contenedor → puerto expuesto en el host
            var portMap = {
              'contenedor1': 3000,
              'contenedor2': 3001,
              'contenedor3': 3002
            };
            var port = portMap[container] || 5000;
            // Construye la URL usando localhost y el puerto mapeado
            this.action = 'http://localhost:' + port + '/upload/' +
                          encodeURIComponent(uid) + '/' +
                          encodeURIComponent(nombreArchivo);
            this.submit();
        });
        </script>
    {% endif %}
    <a class="btn" href="{{ url_for('index') }}">Volver al inicio</a>
</body>
</html>